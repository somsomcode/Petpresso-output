<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ì´ë¯¸ì§€ ì—…ë¡œë“œ</title>
  <style>
    body {
      font-family: sans-serif;
      padding: 40px;
      text-align: center;
      background: #f9f9fb;
      color: #333;
    }

    h2, h3 {
      color: #444;
    }

    form {
      background: white;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.05);
      display: inline-block;
      max-width: 600px;
      width: 100%;
    }

    input[type="text"], input[type="file"] {
      width: 80%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid #ccc;
      border-radius: 6px;
    }

    button {
      padding: 10px 20px;
      margin-top: 10px;
      background: #5567ff;
      border: none;
      color: white;
      font-weight: bold;
      border-radius: 6px;
      cursor: pointer;
    }

    button:hover {
      background: #3748d4;
    }

    #result {
      margin-top: 30px;
      display: none;
      background: #e6f4ea;
      border: 1px solid #c2e0cb;
      padding: 20px;
      border-radius: 10px;
      max-width: 600px;
      margin-left: auto;
      margin-right: auto;
    }

    #result input {
      width: 80%;
      padding: 8px;
      margin-top: 10px;
      border: 1px solid #aaa;
      border-radius: 6px;
    }

    #result button {
      margin-left: 8px;
      padding: 8px 16px;
    }

    #image-list {
      margin-top: 40px;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
      text-align: left;
    }

    .item {
      background: #fff;
      padding: 16px;
      margin-bottom: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 6px rgba(0,0,0,0.05);
      border-left: 4px solid #7d77ff;
    }

    .item strong {
      font-size: 1.1em;
      color: #333;
    }

    .item button {
      background: #ff5f5f;
      margin-top: 10px;
    }

    .item button:hover {
      background: #d64444;
    }

    .sub-list {
      margin-top: 12px;
      font-size: 0.95em;
      line-height: 1.5;
      padding-left: 10px;
    }

    .sub-list u {
      font-weight: bold;
      color: #444;
    }

    a {
      color: #3758ff;
      text-decoration: none;
    }

    a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <h2>ì‚¬ìš©ì ì „ë‹¬ìš© ì´ë¯¸ì§€ ì—…ë¡œë“œ</h2>
  <p style="max-width: 600px; margin: 10px auto 30px; font-size: 0.95em; color: #555; line-height: 1.6;">
    <strong>1.</strong> ì‚¬ìš©ì IDë¥¼ ì…ë ¥í•˜ê³  (IDëŠ” ê°œë³„ URL ìƒì„±ìš© ì…ë‹ˆë‹¤.) <br>ì´ë¯¸ì§€ë¥¼ ì„ íƒí•œ í›„ 'ì „ë‹¬ìš© ë§í¬ ìƒì„±í•˜ê¸°'ë¥¼ ëˆ„ë¥´ì„¸ìš”.<br>
    <strong>2.</strong> ì—…ë¡œë“œê°€ ì™„ë£Œë˜ë©´ ë§í¬ê°€ ìƒì„±ë˜ë©°, ë³µì‚¬í•˜ê±°ë‚˜ ë°”ë¡œ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.<br>
    <strong>3.</strong> ì•„ë˜ ëª©ë¡ì—ì„œëŠ” ì‚¬ìš©ìë³„ ì—…ë¡œë“œ ë‚´ì—­ê³¼ ë§í¬ë¥¼ í™•ì¸í•˜ê³  ì‚­ì œí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
  </p>

  <form id="upload-form" enctype="multipart/form-data">
    ì‚¬ìš©ì ID:<br>
    <input type="text" name="userId" required><br>
    ì´ë¯¸ì§€ ì„ íƒ:<br>
    <input type="file" name="image" accept="image/*" required><br>
    <button type="submit">ì „ë‹¬ìš© ë§í¬ ìƒì„±í•˜ê¸°</button>
  </form>

  <div id="result">
    <p>âœ… ì—…ë¡œë“œ ì™„ë£Œ! ì•„ë˜ ë§í¬ë¥¼ ë³µì‚¬í•˜ê±°ë‚˜ ë°”ë¡œ í™•ì¸í•˜ì„¸ìš”:</p>
    <input id="result-link" type="text" readonly>
    <button onclick="copyLink()">ë³µì‚¬</button>
    <button onclick="goToLink()">ë°”ë¡œê°€ê¸°</button>
  </div>

  <h3>ğŸ“‚ ì‚¬ìš©ìë³„ ì—…ë¡œë“œ ë° ì „ë‹¬ ë§í¬ ëª©ë¡</h3>
  <div id="image-list">ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</div>

  <script>
    const form = document.getElementById('upload-form');
    const resultDiv = document.getElementById('result');
    const resultInput = document.getElementById('result-link');

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      const userId = formData.get('userId');

      const res = await fetch('/upload', {
        method: 'POST',
        body: formData
      });

      if (res.ok) {
        const result = await res.json();
        resultInput.value = window.location.origin + result.link;
        resultDiv.style.display = 'block';
        form.reset();
        loadImageList();
      } else {
        alert('âŒ ì—…ë¡œë“œ ì‹¤íŒ¨! ì„œë²„ ì—ëŸ¬ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
      }
    });

    function copyLink() {
      const input = document.getElementById('result-link');
      input.select();
      document.execCommand('copy');
      alert('ğŸ“‹ ë§í¬ê°€ ë³µì‚¬ë˜ì—ˆìŠµë‹ˆë‹¤!');
    }

    function goToLink() {
      const url = resultInput.value;
      if (url) window.open(url, '_blank');
    }

    async function loadImageList() {
      const listContainer = document.getElementById('image-list');
      listContainer.innerHTML = 'ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...';

      try {
        const res = await fetch('/list');
        const data = await res.json();

        if (!data || Object.keys(data).length === 0) {
          listContainer.innerHTML = '<p>ì•„ì§ ì—…ë¡œë“œëœ ì´ë¯¸ì§€ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
          return;
        }

        const html = Object.entries(data).map(([id, obj]) => {
          const urls = obj.urls || [];
          const files = obj.files || [];

          const fileList = files.map(file => `
            <div>ğŸ“ ${file}</div>
          `).join('');

          const urlList = urls.map(url => `
            <div>ğŸ”— <a href="${url}" target="_blank">${url}</a></div>
          `).join('');

          return `
            <div class="item">
              <strong>ğŸ‘¤ ì‚¬ìš©ì ID: ${id}</strong>
              <div class="sub-list">
                <u>ì €ì¥ëœ ì´ë¯¸ì§€ íŒŒì¼:</u><br>${fileList}
              </div>
              <div class="sub-list">
                <u>ì „ë‹¬ìš© ë§í¬:</u><br>${urlList}
              </div>
              <button onclick="deleteImage('${id}')">ëª¨ë‘ ì‚­ì œ</button>
            </div>
          `;
        }).join('');

        listContainer.innerHTML = html;
      } catch (error) {
        console.error('âŒ ë¦¬ìŠ¤íŠ¸ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨:', error);
        listContainer.innerHTML = '<p>âŒ ë¦¬ìŠ¤íŠ¸ ë¡œë”© ì˜¤ë¥˜</p>';
      }
    }

    async function deleteImage(id) {
      if (!confirm(`ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (${id})`)) return;

      try {
        const res = await fetch('/delete', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ userId: id })
        });

        if (res.ok) {
          alert('âœ… ì‚­ì œ ì™„ë£Œ');
          loadImageList();
        } else {
          alert('âŒ ì‚­ì œ ì‹¤íŒ¨');
        }
      } catch (err) {
        alert('âŒ ì‚­ì œ ì¤‘ ì˜¤ë¥˜ ë°œìƒ');
        console.error(err);
      }
    }

    loadImageList();
  </script>
</body>
</html>
